<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch Club Trends Data</title>
</head>
<body>
    <h1>Club Trends Data</h1>
    <p>The data will be fetched every second and downloaded as <strong>club91.txt</strong>.</p>
    <pre id="output">Fetching data...</pre>

    <script>
        // Function to trigger the download of data as a TXT file
        function downloadTXT(data) {
            const textContent = JSON.stringify(data, null, 2); // You can format the text here if needed
            const blob = new Blob([textContent], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'club91.txt';
            link.click();
        }

        // Function to fetch club trends data
        async function fetchClubTrendsData() {
            const maxAttempts = 5;
            const backoffTime = 1000; // In milliseconds
            let attempt = 0;

            while (attempt < maxAttempts) {
                try {
                    const currentGMT = new Date();
                    const timestamp = Math.floor(currentGMT.getTime() / 1000);

                    const headers = {
                        'User-Agent': 'Mozilla/5.0 (X11; Windows x86_64; rv:120.0) Gecko/20100101 Firefox/120.0',
                        'Accept': 'application/json, text/plain, */*',
                        'Accept-Language': 'en-US,en;q=0.5',
                        'Content-Type': 'application/json;charset=UTF-8',
                        'Authorization': 'Bearer <YOUR_TOKEN_HERE>',
                        'Origin': 'https://91clubin.in',
                        'Connection': 'keep-alive',
                        'Referer': 'https://91clubin.in/',
                        'Sec-Fetch-Dest': 'empty',
                        'Sec-Fetch-Mode': 'cors',
                        'Sec-Fetch-Site': 'cross-site',
                    };

                    const jsonData = {
                        'pageSize': 10,
                        'pageNo': 1,
                        'typeId': 1,
                        'language': 0,
                        'random': 'f61ad7651a734f8c9de8f5b051bdb0f9',
                        'signature': '30423F9542005A1170A3C8D2ECA46E8E',
                        'timestamp': timestamp,
                    };

                    const response = await fetch('https://91clubapi.com/api/webapi/GetNoaverageEmerdList', {
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify(jsonData),
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    const data = await response.json();

                    // Update the output area on the page
                    document.getElementById('output').textContent = JSON.stringify(data, null, 2);

                    // Automatically download the data as TXT file
                    downloadTXT(data);

                    return;
                } catch (error) {
                    console.error(`Attempt ${attempt + 1} failed:`, error);
                    attempt++;
                    if (attempt < maxAttempts) {
                        await new Promise(resolve => setTimeout(resolve, backoffTime));
                    } else {
                        document.getElementById('output').textContent = 'Failed to fetch data after multiple attempts.';
                    }
                }
            }
        }

        // Automatically fetch data every second
        fetchClubTrendsData(); // Fetch immediately
        setInterval(fetchClubTrendsData, 1000); // Fetch every second
    </script>
</body>
</html>
